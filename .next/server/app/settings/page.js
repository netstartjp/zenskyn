(()=>{var e={};e.id=938,e.ids=[938],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4297:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),r(5964),r(2029),r(5866);var s=r(3191),a=r(8716),i=r(7922),n=r.n(i),o=r(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5964)),"C:\\Users\\kazuy\\sns\\src\\app\\settings\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"C:\\Users\\kazuy\\sns\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\kazuy\\sns\\src\\app\\settings\\page.tsx"],u="/settings/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/settings/page",pathname:"/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},250:(e,t,r)=>{Promise.resolve().then(r.bind(r,9929))},9929:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(326),a=r(7577),i=r(9269),n=r(426),o=r.n(n);let l=()=>{let{showToast:e}=(0,i.p)(),[t,r]=(0,a.useState)(null),[n,l]=(0,a.useState)(""),[c,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(""),[m,g]=(0,a.useState)(""),[h,f]=(0,a.useState)(""),[x,_]=(0,a.useState)(""),[v,j]=(0,a.useState)(!0),[b,y]=(0,a.useState)(null),N=(0,a.useCallback)(async()=>{j(!0),y(null);let e=localStorage.getItem("token");if(!e){y("認証が必要です。"),j(!1);return}try{let t=await fetch("/api/auth/status",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let s=(await t.json()).userId,a=await fetch(`/api/users/${s}`,{headers:{Authorization:`Bearer ${e}`}});if(a.ok){let e=await a.json();r(e),l(e.name||""),d(e.bio||""),p(e.profileImageUrl||""),g(e.customId||"")}else{let e=await a.json();y(e.error||"ユーザープロフィールの取得に失敗しました。")}}else{let e=await t.json();y(e.error||"認証情報の取得に失敗しました。")}}catch(e){y("予期せぬエラーが発生しました。"),console.error(e)}finally{j(!1)}},[]);(0,a.useEffect)(()=>{N()},[N]);let S=async r=>{if(r.preventDefault(),y(null),!t){e({title:"エラー",description:"ユーザー情報が読み込まれていません。",variant:"error"});return}if(h!==x){e({title:"エラー",description:"パスワードが一致しません。",variant:"error"});return}let s=localStorage.getItem("token");if(!s){e({title:"エラー",description:"認証が必要です。",variant:"error"});return}let a={};if(n!==t.name){if(null!==n){let r=await fetch(`/api/users/check-name?name=${encodeURIComponent(n)}`);if(!r.ok){e({title:"エラー",description:(await r.json()).error||"ユーザー名の重複チェックに失敗しました。",variant:"error"});return}let s=await r.json();if(s.exists&&s.userId!==t.id){e({title:"エラー",description:"このユーザー名はすでに使用されています。別の名前をお試しください。",variant:"error"});return}}a.name=n}c!==t.bio&&(a.bio=c),u!==t.profileImageUrl&&(a.profileImageUrl=u),""!==h&&(a.password=h);let i=!1;if(m!==(t.customId||""))try{let r=await fetch(`/api/users/${t.id}/custom-id`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({customId:m})});if(!r.ok){let t=await r.json();e({title:"エラー",description:t.error||"カスタムIDの更新に失敗しました。",variant:"error"});return}i=!0}catch(t){e({title:"エラー",description:"カスタムIDの更新中にエラーが発生しました。",variant:"error"}),console.error(t);return}if(0===Object.keys(a).length&&!i){e({title:"情報",description:"変更がありません。",variant:"info"});return}try{let r=await fetch(`/api/users/${t.id}/update`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)});if(r.ok)e({title:"成功",description:"プロフィールが正常に更新されました。",variant:"success"}),N();else{let t=await r.json();e({title:"エラー",description:t.error||"プロフィールの更新に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"予期せぬエラーが発生しました。",variant:"error"}),console.error(t)}};return v?s.jsx("div",{className:o().loadingMessage,children:"設定を読み込み中..."}):b?s.jsx("div",{className:o().errorMessage,children:b}):(0,s.jsxs)("div",{className:o().settingsContainer,children:[s.jsx("h2",{className:o().sectionTitle,children:"プロフィール設定"}),(0,s.jsxs)("form",{onSubmit:S,className:o().form,children:[(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"name",className:o().formLabel,children:"名前:"}),s.jsx("input",{type:"text",id:"name",value:n,onChange:e=>l(e.target.value),className:o().inputField})]}),(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"bio",className:o().formLabel,children:"自己紹介:"}),s.jsx("textarea",{id:"bio",value:c,onChange:e=>d(e.target.value),className:o().textareaField,rows:3})]}),(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"profileImageUrl",className:o().formLabel,children:"プロフィール画像URL:"}),s.jsx("input",{type:"text",id:"profileImageUrl",value:u,onChange:e=>p(e.target.value),className:o().inputField})]}),(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"customId",className:o().formLabel,children:"カスタムID (@なし):"}),s.jsx("input",{type:"text",id:"customId",value:m,onChange:e=>g(e.target.value),className:o().inputField,placeholder:"例: myusername"})]}),(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"password",className:o().formLabel,children:"新しいパスワード (変更する場合のみ):"}),s.jsx("input",{type:"password",id:"password",value:h,onChange:e=>f(e.target.value),className:o().inputField,placeholder:"新しいパスワード"})]}),(0,s.jsxs)("div",{className:o().formGroup,children:[s.jsx("label",{htmlFor:"confirmPassword",className:o().formLabel,children:"新しいパスワード (確認):"}),s.jsx("input",{type:"password",id:"confirmPassword",value:x,onChange:e=>_(e.target.value),className:o().inputField,placeholder:"新しいパスワードを再入力"})]}),s.jsx("div",{className:o().formActions,children:s.jsx("button",{type:"submit",className:o().saveButton,children:"設定を保存"})})]})]})};var c=r(6550),d=r.n(c);function u(){return(0,s.jsxs)("div",{className:d().container,children:[s.jsx("h1",{className:d().title,children:"ユーザー設定"}),s.jsx(l,{})]})}},6550:e=>{e.exports={container:"settings_container__2ie5P",title:"settings_title__DMbFh"}},426:e=>{e.exports={settingsContainer:"UserSettings_settingsContainer__bF265",sectionTitle:"UserSettings_sectionTitle__5higR",form:"UserSettings_form__V8S5j",formGroup:"UserSettings_formGroup__ruwuw",formLabel:"UserSettings_formLabel__KcGCG",inputField:"UserSettings_inputField__uj2DX",textareaField:"UserSettings_textareaField__ABtg7",formActions:"UserSettings_formActions__h_lYg",saveButton:"UserSettings_saveButton__07UDo",loadingMessage:"UserSettings_loadingMessage__x7FNh",errorMessage:"UserSettings_errorMessage__5G5Pc"}},5964:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`C:\Users\kazuy\sns\src\app\settings\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,928,484],()=>r(4297));module.exports=s})();