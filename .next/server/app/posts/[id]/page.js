(()=>{var e={};e.id=722,e.ids=[722],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3174:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>d,pages:()=>m,routeModule:()=>p,tree:()=>c}),s(9292),s(2029),s(5866);var n=s(3191),r=s(8716),o=s(7922),i=s.n(o),a=s(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);s.d(t,l);let c=["",{children:["posts",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,9292)),"C:\\Users\\kazuy\\sns\\src\\app\\posts\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"C:\\Users\\kazuy\\sns\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],m=["C:\\Users\\kazuy\\sns\\src\\app\\posts\\[id]\\page.tsx"],d="/posts/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/posts/[id]/page",pathname:"/posts/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5897:(e,t,s)=>{Promise.resolve().then(s.bind(s,3576))},3576:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var n=s(326),r=s(7577),o=s(5047),i=s(434),a=s(6974),l=s.n(a),c=s(4695),m=s(9269);function d({params:e}){let{showToast:t}=(0,m.p)(),s=(0,o.useRouter)(),a=e.id,[d,u]=(0,r.useState)(null),[p,_]=(0,r.useState)(!0),[h,x]=(0,r.useState)(null),[g,f]=(0,r.useState)(null);return((0,r.useCallback)(async()=>{_(!0),x(null);let e=localStorage.getItem("token");if(e)try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=JSON.parse(window.atob(t));f(String(s.userId))}catch(e){console.error("トークンのデコードに失敗しました",e),f(null)}try{let e=await fetch(`/api/posts/${a}`);if(e.ok){let t=await e.json();u(t)}else{let t=await e.json();x(t.error||"投稿の取得に失敗しました。")}}catch(e){x("予期せぬエラーが発生しました。"),console.error(e)}finally{_(!1)}},[a]),p)?n.jsx("div",{className:l().loadingMessage,children:"投稿を読み込み中..."}):h?n.jsx("div",{className:l().errorMessage,children:h}):d?(0,n.jsxs)("div",{className:l().container,children:[(0,n.jsxs)("header",{className:l().header,children:[n.jsx("h1",{className:l().title,children:"投稿詳細"}),n.jsx(i.default,{href:"/",children:n.jsx("button",{className:l().backButton,children:"ホームに戻る"})})]}),n.jsx("main",{className:l().mainContent,children:n.jsx(c.S,{post:d,onPostDeleted:()=>{s.push("/"),t({title:"成功",description:"投稿が削除されました。",variant:"success"})},currentUserId:g})})]}):n.jsx("div",{className:l().errorMessage,children:"投稿が見つかりませんでした。"})}},4695:(e,t,s)=>{"use strict";s.d(t,{S:()=>p});var n=s(326),r=s(7577),o=s(434),i=s(8835),a=s.n(i),l=s(9269),c=s(7531),m=s(5769),d=s.n(m);let u=({postId:e,onCommentSuccess:t,type:s="REPLY"})=>{let[o,i]=(0,r.useState)(""),[a,l]=(0,r.useState)(""),c=async n=>{n.preventDefault(),l("");let r=localStorage.getItem("token");if(!r){l("投稿するにはログインが必要です。");return}if(!o.trim()&&"REPOST"!==s){l("内容を入力してください。");return}try{let n=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({content:o,type:s,parentId:e})});if(n.ok)i(""),t();else{let e=await n.json();l(e.error||"投稿に失敗しました。")}}catch(e){l("予期せぬエラーが発生しました。")}};return(0,n.jsxs)("form",{onSubmit:c,className:d().commentForm,children:["REPOST"!==s&&n.jsx("textarea",{value:o,onChange:e=>i(e.target.value),placeholder:"REPLY"===s?"コメントを追加...":"引用コメントを追加...",className:d().textareaField,rows:2,required:"REPOST"!==s}),a&&n.jsx("p",{className:d().errorMessage,children:a}),n.jsx("button",{type:"submit",className:d().submitButton,children:"REPLY"===s?"コメント":"QUOTE"===s?"引用投稿":"リポスト"})]})},p=({post:e,onPostDeleted:t,currentUserId:s})=>{let{showToast:i}=(0,l.p)(),{showPopover:m}=(0,c.t)(),[d,p]=(0,r.useState)(e.likedByCurrentUser),[_,h]=(0,r.useState)(e.likesCount),x=(0,r.useRef)(null),[g,f]=(0,r.useState)(!1),[j,C]=(0,r.useState)(e.children||[]);(0,r.useEffect)(()=>{C(e.children||[])},[e.children]);let T=async(e,s)=>{let n=localStorage.getItem("token");if(!n){i({title:"エラー",description:"コメントを削除するにはログインが必要です。",variant:"error"});return}m({anchorElement:s.currentTarget,title:"確認",description:"このコメントを削除してもよろしいですか？",variant:"warning",onConfirm:async()=>{try{let s=await fetch(`/api/comments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(s.ok)i({title:"成功",description:"コメントが削除されました！",variant:"success"}),t&&t();else{let e=await s.json();i({title:"エラー",description:e.error||"コメントの削除に失敗しました。",variant:"error"})}}catch(e){i({title:"エラー",description:"予期せぬエラーが発生しました。",variant:"error"})}},onCancel:()=>{i({title:"キャンセル",description:"コメントの削除をキャンセルしました。",variant:"info"})}})},k=async()=>{let t=localStorage.getItem("token");if(!t){i({title:"エラー",description:"ログインしてください。",variant:"error"});return}try{let s=await fetch(`/api/posts/${e.id}/like`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(s.ok){let e=await s.json();p(e.liked),h(e.likesCount)}else{let e=await s.json();i({title:"エラー",description:e.error||"いいねに失敗しました。",variant:"error"})}}catch(e){i({title:"エラー",description:"ネットワークエラーが発生しました。",variant:"error"})}},P=async()=>{if(!window.confirm("本当にこの投稿を削除しますか？"))return;let s=localStorage.getItem("token");if(!s){i({title:"エラー",description:"ログインしてください。",variant:"error"});return}try{let n=await fetch(`/api/posts/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(n.ok)i({title:"成功",description:"投稿を削除しました。",variant:"success"}),t&&t();else{let e=await n.json();i({title:"エラー",description:e.error||"投稿の削除に失敗しました。",variant:"error"})}}catch(e){i({title:"エラー",description:"ネットワークエラーが発生しました。",variant:"error"})}};return(0,n.jsxs)("div",{className:a().postCard,children:[(0,n.jsxs)("div",{className:a().postHeader,children:[(0,n.jsxs)(o.default,{href:`/users/${e.author.id}`,className:a().postAuthor,children:[e.author.name||"名無しユーザー",e.author.customId&&(0,n.jsxs)("span",{className:a().postAuthorCustomId,children:[" @",e.author.customId]})," "]}),n.jsx("span",{className:a().postDate,children:new Date(e.createdAt).toLocaleString()})]}),n.jsx("p",{className:a().postContent,children:(e=>{let t=[],s=0;return e.replace(/@([a-zA-Z0-9_]+)/g,(r,i,l)=>(l>s&&t.push(e.substring(s,l)),t.push(n.jsx(o.default,{href:`/users/@${i}`,className:a().mentionLink,children:r},l)),s=l+r.length,r)),s<e.length&&t.push(e.substring(s)),t})(e.content)}),(0,n.jsxs)("div",{className:a().postActions,children:[(0,n.jsxs)("button",{onClick:k,className:`${a().likeButton} ${d?a().liked:""}`,children:["いいね (",_,")"]}),n.jsx("button",{onClick:()=>f(!g),className:a().commentButton,children:"コメント"}),n.jsx("button",{ref:x,onClick:()=>{let t=`${window.location.origin}/posts/${e.id}`;navigator.clipboard.writeText(t).then(()=>{m({title:"成功",description:"投稿URLをコピーしました！",variant:"success",anchorElement:x.current})}).catch(()=>{m({title:"エラー",description:"URLのコピーに失敗しました。",variant:"error",anchorElement:x.current})})},className:a().shareButton,children:"共有"}),s&&e.author.id===s&&n.jsx("button",{onClick:P,className:a().deleteButton,children:"削除"})]}),g&&(0,n.jsxs)("div",{className:a().commentsSection,children:[(0,n.jsxs)("h4",{className:a().commentsTitle,children:["リプライ (",(e.children??[]).filter(e=>"REPLY"===e.type).length||0,")"]}),(j??[]).filter(e=>"REPLY"===e.type).length>0?n.jsx("div",{className:a().commentList,children:(j??[]).filter(e=>"REPLY"===e.type).map(e=>(0,n.jsxs)("div",{className:a().commentItem,children:[n.jsx(o.default,{href:`/users/${e.author.id}`,className:a().commentAuthor,children:e.author.name||`ユーザー ${e.author.id}`}),n.jsx("span",{className:a().commentDate,children:new Date(e.createdAt).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),n.jsx("p",{className:a().commentContent,children:e.content}),s===e.author.id&&n.jsx("button",{onClick:t=>T(e.id,t),className:a().deleteCommentButton,children:"削除"})]},e.id))}):n.jsx("p",{className:a().noCommentsMessage,children:"まだリプライがありません。"}),n.jsx(u,{postId:e.id,onCommentSuccess:()=>{t&&t()}})]})]})}},6974:e=>{e.exports={container:"post_container___fUkB",header:"post_header__ZZjtN",title:"post_title__4b_8c",backButton:"post_backButton__o7Fsh",loadingMessage:"post_loadingMessage__XnXRv",errorMessage:"post_errorMessage__6ATIb",mainContent:"post_mainContent__4_dxN"}},5769:e=>{e.exports={commentForm:"CommentForm_commentForm__i01GW",textareaField:"CommentForm_textareaField__MwKjj",submitButton:"CommentForm_submitButton__FUJ5s",errorMessage:"CommentForm_errorMessage__5mag3"}},8835:e=>{e.exports={timelineContainer:"Timeline_timelineContainer__WppA0",postCard:"Timeline_postCard__uYZ6G",postHeader:"Timeline_postHeader__HB5Zr",authorLink:"Timeline_authorLink__dEne2",postDate:"Timeline_postDate__rxDpH",postContent:"Timeline_postContent__ykYZl",postActions:"Timeline_postActions__WRJIp",likeButton:"Timeline_likeButton__uGXsZ",deleteButton:"Timeline_deleteButton__aipxl",deleteCommentButton:"Timeline_deleteCommentButton__hPy4n",actionButton:"Timeline_actionButton__Vc6Up",liked:"Timeline_liked__BaUx6",likeIcon:"Timeline_likeIcon__w6slr",noPostsMessage:"Timeline_noPostsMessage__hSXgH",commentsSection:"Timeline_commentsSection__iLyP0",commentsTitle:"Timeline_commentsTitle__pydHp",commentList:"Timeline_commentList__2M_o7",commentItem:"Timeline_commentItem__t3_hZ",commentAuthor:"Timeline_commentAuthor__RmxM7",commentDate:"Timeline_commentDate___0FII",commentContent:"Timeline_commentContent__VXGfn",noCommentsMessage:"Timeline_noCommentsMessage__cuM0l",quotedPost:"Timeline_quotedPost__ysRJM",repostedPost:"Timeline_repostedPost__Jh1if",replyToPost:"Timeline_replyToPost__4xRUq",quotedPostHeader:"Timeline_quotedPostHeader__m4Hb_",repostedPostHeader:"Timeline_repostedPostHeader__XOZdY",quotedPostContent:"Timeline_quotedPostContent__uUycL",repostedPostContent:"Timeline_repostedPostContent__mWZgd",quoteFormContainer:"Timeline_quoteFormContainer__tHgf1",mentionLink:"Timeline_mentionLink__GHGHW",postAuthorCustomId:"Timeline_postAuthorCustomId__rI2Sx"}},9292:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});let n=(0,s(8570).createProxy)(String.raw`C:\Users\kazuy\sns\src\app\posts\[id]\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[276,928,484],()=>s(3174));module.exports=n})();