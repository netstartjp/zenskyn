(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6392:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>m,tree:()=>c}),s(5480),s(2029),s(5866);var a=s(3191),r=s(8716),o=s(7922),n=s.n(o),i=s(5231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);s.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5480)),"C:\\Users\\kazuy\\sns\\src\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"C:\\Users\\kazuy\\sns\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Users\\kazuy\\sns\\src\\app\\page.tsx"],d="/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4161:(e,t,s)=>{Promise.resolve().then(s.bind(s,729))},729:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var a=s(326),r=s(7577),o=s(5047),n=s(7186),i=s.n(n);let l=({onAuthSuccess:e})=>{let[t,s]=(0,r.useState)(!0),[o,n]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,d]=(0,r.useState)(""),[p,m]=(0,r.useState)(""),h=async s=>{s.preventDefault(),m("");let a=t?{email:o,password:l}:{email:o,name:u,password:l};try{let s=await fetch(t?"/api/auth/login":"/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(s.ok){if(t){let e=await s.json();localStorage.setItem("token",e.token)}else{let e=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:l})}),t=await e.json();localStorage.setItem("token",t.token)}e()}else{let e=await s.json();m(e.error||"エラーが発生しました。")}}catch(e){m("予期せぬエラーが発生しました。")}};return(0,a.jsxs)("div",{className:i().authFormContainer,children:[(0,a.jsxs)("div",{className:i().tabs,children:[a.jsx("button",{onClick:()=>s(!0),className:`${i().tabButton} ${t?i().activeTab:""}`,children:"ログイン"}),a.jsx("button",{onClick:()=>s(!1),className:`${i().tabButton} ${t?"":i().activeTab}`,children:"新規登録"})]}),(0,a.jsxs)("form",{onSubmit:h,className:i().form,children:[a.jsx("h2",{className:i().formTitle,children:t?"ログイン":"新規登録"}),p&&a.jsx("p",{className:i().errorMessage,children:p}),!t&&a.jsx("input",{type:"text",placeholder:"名前",value:u,onChange:e=>d(e.target.value),className:i().inputField}),a.jsx("input",{type:"email",placeholder:"メールアドレス",value:o,onChange:e=>n(e.target.value),required:!0,className:i().inputField}),a.jsx("input",{type:"password",placeholder:"パスワード",value:l,onChange:e=>c(e.target.value),required:!0,className:i().inputField}),a.jsx("button",{type:"submit",className:i().submitButton,children:t?"ログイン":"登録"})]})]})};var c=s(5330),u=s.n(c),d=s(9269);let p=({onPostSuccess:e})=>{let{showToast:t}=(0,d.p)(),[s,o]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),l=async a=>{a.preventDefault(),i("");let r=localStorage.getItem("token");if(!r){i("投稿するにはログインが必要です。"),t({title:"エラー",description:"投稿するにはログインが必要です。",variant:"error"});return}try{let a=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({content:s})});if(a.ok)o(""),t({title:"成功",description:"投稿が成功しました！",variant:"success"}),e();else{let e=await a.json();i(e.error||"投稿に失敗しました。"),t({title:"エラー",description:e.error||"投稿に失敗しました。",variant:"error"})}}catch(e){i("予期せぬエラーが発生しました。"),t({title:"エラー",description:"予期せぬエラーが発生しました。",variant:"error"})}};return(0,a.jsxs)("form",{onSubmit:l,className:u().postForm,children:[a.jsx("textarea",{value:s,onChange:e=>o(e.target.value),placeholder:"今、何を考えていますか？",className:u().textareaField,rows:5,required:!0}),n&&a.jsx("p",{className:u().errorMessage,children:n}),a.jsx("button",{type:"submit",className:u().submitButton,children:"投稿"})]})};var m=s(7318),h=s(8045),_=s.n(h);let g=({onSetupComplete:e})=>{let[t,s]=(0,r.useState)(""),[o,n]=(0,r.useState)(""),[i,l]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[d,p]=(0,r.useState)(""),m=async s=>{s.preventDefault(),u(""),p("");try{let s=await fetch("/api/admin/setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,name:i,password:o})});if(s.ok)p("管理者アカウントが正常に作成されました。ログインしてください。"),e();else{let e=await s.json();u(e.error||"管理者アカウントの作成に失敗しました。")}}catch(e){u("予期せぬエラーが発生しました。")}};return(0,a.jsxs)("div",{className:_().adminSetupContainer,children:[a.jsx("h2",{className:_().title,children:"管理者アカウントの作成"}),a.jsx("p",{className:_().description,children:"最初のユーザーとして管理者アカウントを作成してください。"}),c&&a.jsx("p",{className:_().errorMessage,children:c}),d&&a.jsx("p",{className:_().successMessage,children:d}),(0,a.jsxs)("form",{onSubmit:m,className:_().form,children:[a.jsx("input",{type:"text",placeholder:"名前 (任意)",value:i,onChange:e=>l(e.target.value),className:_().inputField}),a.jsx("input",{type:"email",placeholder:"メールアドレス (管理者)",value:t,onChange:e=>s(e.target.value),required:!0,className:_().inputField}),a.jsx("input",{type:"password",placeholder:"パスワード (管理者)",value:o,onChange:e=>n(e.target.value),required:!0,className:_().inputField}),a.jsx("button",{type:"submit",className:_().submitButton,children:"管理者アカウントを作成"})]})]})};var x=s(5419),j=s.n(x);function S(){let[e,t]=(0,r.useState)(null),[s,n]=(0,r.useState)([]),[i,c]=(0,r.useState)(void 0),[u,d]=(0,r.useState)("");(0,o.useRouter)();let h=(0,r.useCallback)(async()=>{console.log("fetchPosts called");try{let e=await fetch("/api/posts");if(e.ok){let t=await e.json();n(t)}}catch(e){console.error("Failed to fetch posts:",e)}},[]),_=(0,r.useCallback)(async()=>{console.log("checkUsers called");try{let e=await fetch("/api/admin/check");if(e.ok){let t=await e.json();console.log("checkUsers API response:",t),c(t.hasUsers)}else console.error("Failed to check users:",await e.json()),c(!0)}catch(e){console.error("Error checking users:",e),c(!0)}},[]),x=(0,r.useCallback)(async()=>{console.log("fetchAuthStatus called");let e=localStorage.getItem("token");if(!e){t({loggedIn:!1,userId:null,isAdmin:!1});return}try{let s=await fetch("/api/auth/status",{headers:{Authorization:`Bearer ${e}`}});if(s.ok){let e=await s.json();console.log("Auth Status API response:",e),t(e)}else console.error("Failed to fetch auth status:",await s.json()),t({loggedIn:!1,userId:null,isAdmin:!1}),localStorage.removeItem("token")}catch(e){console.error("Error fetching auth status:",e),t({loggedIn:!1,userId:null,isAdmin:!1}),localStorage.removeItem("token")}},[]),S=async()=>{console.log("handleAdminSetupComplete called"),await _(),x()};return(console.log("Render: hasUsers=",i,"authStatus=",e),void 0===i||null===e)?a.jsx("div",{className:j().loadingMessage,children:"読み込み中..."}):i?(0,a.jsxs)("div",{className:j().container,children:[a.jsx("header",{className:j().header,children:a.jsx("h1",{className:j().title,children:"SNS"})}),(0,a.jsxs)("main",{className:j().mainContent,children:[e.loggedIn?(0,a.jsxs)("section",{children:[a.jsx("h2",{className:j().sectionTitle,children:"投稿を作成"}),a.jsx(p,{onPostSuccess:()=>{console.log("handlePostSuccess called"),h()}})]}):a.jsx("section",{children:a.jsx(l,{onAuthSuccess:()=>{console.log("handleAuthSuccess called"),x(),h()}})}),(0,a.jsxs)("section",{children:[a.jsx("h2",{className:j().sectionTitle,children:"タイムライン"}),a.jsx(m.T,{posts:s,onPostDeleted:h})]})]})]}):a.jsx(g,{onSetupComplete:S})}},5419:e=>{e.exports={container:"page_container__aoG4z",header:"page_header__kVzhN",title:"page_title__3jonF",headerNav:"page_headerNav__s8uUQ",searchForm:"page_searchForm__LFzRP",searchInput:"page_searchInput__spYJs",searchButton:"page_searchButton__vE0yS",logoutButton:"page_logoutButton__K4PKs",adminButton:"page_adminButton__Y_ux1",mainContent:"page_mainContent__51TpB",sectionTitle:"page_sectionTitle__hzsAh",loadingMessage:"page_loadingMessage__qCwow"}},8045:e=>{e.exports={adminSetupContainer:"AdminSetupForm_adminSetupContainer__jZRfN",title:"AdminSetupForm_title__IxmHQ",description:"AdminSetupForm_description__tYM2s",errorMessage:"AdminSetupForm_errorMessage__US5jr",successMessage:"AdminSetupForm_successMessage__2vnLZ",form:"AdminSetupForm_form__jYBvN",inputField:"AdminSetupForm_inputField__2DIuC",submitButton:"AdminSetupForm_submitButton__jYpjT"}},7186:e=>{e.exports={authFormContainer:"AuthForm_authFormContainer__9rIw1",tabs:"AuthForm_tabs__eeqHR",tabButton:"AuthForm_tabButton__Je7co",activeTab:"AuthForm_activeTab__N96eK",form:"AuthForm_form__ugvBR",formTitle:"AuthForm_formTitle__lBYAs",errorMessage:"AuthForm_errorMessage__6oozP",inputField:"AuthForm_inputField__MInff",submitButton:"AuthForm_submitButton__nzro7"}},5330:e=>{e.exports={postForm:"PostForm_postForm__bvhhW",textareaField:"PostForm_textareaField__RO987",errorMessage:"PostForm_errorMessage__8GPnr",submitButton:"PostForm_submitButton__S4Vfz"}},5480:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`C:\Users\kazuy\sns\src\app\page.tsx#default`)}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,928,484,318],()=>s(6392));module.exports=a})();