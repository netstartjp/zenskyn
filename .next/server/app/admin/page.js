(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1477:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>s.a,__next_app__:()=>u,originalPathname:()=>h,pages:()=>c,routeModule:()=>m,tree:()=>d}),i(4753),i(2029),i(5866);var n=i(3191),a=i(8716),r=i(7922),s=i.n(r),o=i(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);i.d(t,l);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,4753)),"C:\\Users\\kazuy\\sns\\src\\app\\admin\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,2029)),"C:\\Users\\kazuy\\sns\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\kazuy\\sns\\src\\app\\admin\\page.tsx"],h="/admin/page",u={require:i,loadChunk:()=>Promise.resolve()},m=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2195:(e,t,i)=>{Promise.resolve().then(i.bind(i,4189))},4189:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var n=i(326),a=i(7577),r=i(5047),s=i(434),o=i(7528),l=i.n(o),d=i(9269),c=i(7531);function h(){let{showToast:e}=(0,d.p)(),{showPopover:t}=(0,c.t)(),[i,o]=(0,a.useState)([]),[h,u]=(0,a.useState)([]),[m,p]=(0,a.useState)(!0),[x,j]=(0,a.useState)(null),[_,g]=(0,a.useState)(null),f=(0,r.useRouter)(),v=(0,a.useCallback)(async()=>{p(!0),j(null);let e=localStorage.getItem("token");if(!e){j("認証が必要です。"),p(!1),f.push("/");return}try{let t=await fetch("/api/auth/status",{headers:{Authorization:`Bearer ${e}`}}),i=await t.json();if(!t.ok||!i.isAdmin){j("管理者権限がありません。"),p(!1),f.push("/");return}g(i.userId);let n=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${e}`}});if(n.ok){let e=await n.json();o(e)}else{let e=await n.json();j(e.error||"ユーザーデータの取得に失敗しました。")}let a=await fetch("/api/posts",{headers:{Authorization:`Bearer ${e}`}});if(a.ok){let e=await a.json();u(e)}else{let e=await a.json();j(e.error||"投稿データの取得に失敗しました。")}}catch(e){j("データの取得中に予期せぬエラーが発生しました。"),console.error(e)}finally{p(!1)}},[f]),b=async(i,n)=>{let a=localStorage.getItem("token");if(!a){e({title:"エラー",description:"ユーザーを削除するにはログインが必要です。",variant:"error"});return}t({anchorElement:n.currentTarget,title:"確認",description:"このユーザーを削除してもよろしいですか？この操作は元に戻せません。",variant:"warning",onConfirm:async()=>{try{let t=await fetch(`/api/users/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(t.ok)e({title:"成功",description:"ユーザーが削除されました。",variant:"success"}),v();else{let i=await t.json();e({title:"エラー",description:i.error||"ユーザーの削除に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"ユーザー削除中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"ユーザーの削除をキャンセルしました。",variant:"info"})}})},C=async(i,n,a)=>{t({anchorElement:a.currentTarget,title:"確認",description:`このユーザーの管理者権限を${n?"解除":"付与"}してもよろしいですか？`,variant:"info",onConfirm:async()=>{let t=localStorage.getItem("token");if(i===_&&n){e({title:"警告",description:"自分自身の管理者権限を解除することはできません。システムに管理者がいなくなります。",variant:"warning"});return}try{let a=await fetch(`/api/admin/users/${i}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({isAdmin:!n})});if(a.ok)e({title:"成功",description:`ユーザーの管理者権限を${n?"解除":"付与"}しました。`,variant:"success"}),v();else{let t=await a.json();e({title:"エラー",description:t.error||"管理者権限の変更に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"管理者権限の変更中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"管理者権限の変更をキャンセルしました。",variant:"info"})}})},k=async(i,n)=>{let a=localStorage.getItem("token");if(!a){e({title:"エラー",description:"投稿を削除するにはログインが必要です。",variant:"error"});return}t({anchorElement:n.currentTarget,title:"確認",description:"この投稿を削除してもよろしいですか？この操作は元に戻せません。",variant:"warning",onConfirm:async()=>{try{let t=await fetch(`/api/posts/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(t.ok)e({title:"成功",description:"投稿が削除されました。",variant:"success"}),v();else{let i=await t.json();e({title:"エラー",description:i.error||"投稿の削除に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"投稿削除中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"投稿の削除をキャンセルしました。",variant:"info"})}})};return m?n.jsx("div",{className:l().loadingMessage,children:"管理者ダッシュボードを読み込み中..."}):x?n.jsx("div",{className:l().errorMessage,children:x}):(0,n.jsxs)("div",{className:l().container,children:[(0,n.jsxs)("header",{className:l().header,children:[n.jsx("h1",{className:l().title,children:"管理者ダッシュボード"}),n.jsx(s.default,{href:"/",children:n.jsx("button",{className:l().backButton,children:"ホームに戻る"})})]}),(0,n.jsxs)("main",{className:l().mainContent,children:[(0,n.jsxs)("section",{className:l().section,children:[n.jsx("h2",{className:l().sectionTitle,children:"ユーザー管理"}),n.jsx("div",{className:l().tableContainer,children:(0,n.jsxs)("table",{className:l().table,children:[n.jsx("thead",{children:(0,n.jsxs)("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"名前"}),n.jsx("th",{children:"メール"}),n.jsx("th",{children:"管理者"}),n.jsx("th",{children:"操作"})]})}),n.jsx("tbody",{children:i.map(e=>(0,n.jsxs)("tr",{children:[n.jsx("td",{children:e.id}),n.jsx("td",{children:e.name||"N/A"}),n.jsx("td",{children:e.email}),n.jsx("td",{children:e.isAdmin?"はい":"いいえ"}),(0,n.jsxs)("td",{children:[n.jsx("button",{onClick:()=>f.push(`/users/${e.id}`),className:l().actionButton,children:"表示"}),n.jsx("button",{onClick:t=>b(e.id,t),className:`${l().actionButton} ${l().deleteButton}`,disabled:e.id===_,children:"削除"}),n.jsx("button",{onClick:t=>C(e.id,e.isAdmin,t),className:`${l().actionButton} ${e.isAdmin?l().revokeAdmin:l().grantAdmin}`,disabled:e.id===_,children:e.isAdmin?"管理者解除":"管理者付与"})]})]},e.id))})]})})]}),(0,n.jsxs)("section",{className:l().section,children:[n.jsx("h2",{className:l().sectionTitle,children:"投稿管理"}),n.jsx("div",{className:l().tableContainer,children:(0,n.jsxs)("table",{className:l().table,children:[n.jsx("thead",{children:(0,n.jsxs)("tr",{children:[n.jsx("th",{children:"ID"}),n.jsx("th",{children:"内容"}),n.jsx("th",{children:"投稿者"}),n.jsx("th",{children:"いいね数"}),n.jsx("th",{children:"操作"})]})}),n.jsx("tbody",{children:h.map(e=>(0,n.jsxs)("tr",{children:[n.jsx("td",{children:e.id}),(0,n.jsxs)("td",{children:[e.content.substring(0,50),"..."]}),n.jsx("td",{children:e.author.name||`ユーザー ${e.author.id}`}),n.jsx("td",{children:e.likesCount}),n.jsx("td",{children:n.jsx("button",{onClick:t=>k(e.id,t),className:`${l().actionButton} ${l().deleteButton}`,children:"削除"})})]},e.id))})]})})]})]})]})}},7528:e=>{e.exports={container:"admin_container__uVSVc",header:"admin_header__BXCuK",title:"admin_title__cLzhO",backButton:"admin_backButton__6_Chd",loadingMessage:"admin_loadingMessage__9YF44",errorMessage:"admin_errorMessage__aG44D",mainContent:"admin_mainContent__LKiLk",section:"admin_section__ID0dh",sectionTitle:"admin_sectionTitle__1MY2W",tableContainer:"admin_tableContainer__GVxxO",table:"admin_table__Wi_BD",actionButton:"admin_actionButton__sA_2Z",deleteButton:"admin_deleteButton__CwIux"}},4753:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>n});let n=(0,i(8570).createProxy)(String.raw`C:\Users\kazuy\sns\src\app\admin\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[276,928,484],()=>i(1477));module.exports=n})();