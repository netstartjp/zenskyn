exports.id=318,exports.ids=[318],exports.modules={4695:(e,t,n)=>{"use strict";n.d(t,{S:()=>_});var i=n(326),o=n(7577),s=n(434),r=n(8835),a=n.n(r),l=n(9269),m=n(7531),c=n(5769),d=n.n(c);let u=({postId:e,onCommentSuccess:t,type:n="REPLY"})=>{let[s,r]=(0,o.useState)(""),[a,l]=(0,o.useState)(""),m=async i=>{i.preventDefault(),l("");let o=localStorage.getItem("token");if(!o){l("投稿するにはログインが必要です。");return}if(!s.trim()&&"REPOST"!==n){l("内容を入力してください。");return}try{let i=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({content:s,type:n,parentId:e})});if(i.ok)r(""),t();else{let e=await i.json();l(e.error||"投稿に失敗しました。")}}catch(e){l("予期せぬエラーが発生しました。")}};return(0,i.jsxs)("form",{onSubmit:m,className:d().commentForm,children:["REPOST"!==n&&i.jsx("textarea",{value:s,onChange:e=>r(e.target.value),placeholder:"REPLY"===n?"コメントを追加...":"引用コメントを追加...",className:d().textareaField,rows:2,required:"REPOST"!==n}),a&&i.jsx("p",{className:d().errorMessage,children:a}),i.jsx("button",{type:"submit",className:d().submitButton,children:"REPLY"===n?"コメント":"QUOTE"===n?"引用投稿":"リポスト"})]})},_=({post:e,onPostDeleted:t,currentUserId:n})=>{let{showToast:r}=(0,l.p)(),{showPopover:c}=(0,m.t)(),[d,_]=(0,o.useState)(e.likedByCurrentUser),[p,h]=(0,o.useState)(e.likesCount),T=(0,o.useRef)(null),[x,C]=(0,o.useState)(!1),[g,j]=(0,o.useState)(e.children||[]);(0,o.useEffect)(()=>{j(e.children||[])},[e.children]);let f=async(e,n)=>{let i=localStorage.getItem("token");if(!i){r({title:"エラー",description:"コメントを削除するにはログインが必要です。",variant:"error"});return}c({anchorElement:n.currentTarget,title:"確認",description:"このコメントを削除してもよろしいですか？",variant:"warning",onConfirm:async()=>{try{let n=await fetch(`/api/comments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`}});if(n.ok)r({title:"成功",description:"コメントが削除されました！",variant:"success"}),t&&t();else{let e=await n.json();r({title:"エラー",description:e.error||"コメントの削除に失敗しました。",variant:"error"})}}catch(e){r({title:"エラー",description:"予期せぬエラーが発生しました。",variant:"error"})}},onCancel:()=>{r({title:"キャンセル",description:"コメントの削除をキャンセルしました。",variant:"info"})}})},k=async()=>{let t=localStorage.getItem("token");if(!t){r({title:"エラー",description:"ログインしてください。",variant:"error"});return}try{let n=await fetch(`/api/posts/${e.id}/like`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(n.ok){let e=await n.json();_(e.liked),h(e.likesCount)}else{let e=await n.json();r({title:"エラー",description:e.error||"いいねに失敗しました。",variant:"error"})}}catch(e){r({title:"エラー",description:"ネットワークエラーが発生しました。",variant:"error"})}},P=async()=>{if(!window.confirm("本当にこの投稿を削除しますか？"))return;let n=localStorage.getItem("token");if(!n){r({title:"エラー",description:"ログインしてください。",variant:"error"});return}try{let i=await fetch(`/api/posts/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(i.ok)r({title:"成功",description:"投稿を削除しました。",variant:"success"}),t&&t();else{let e=await i.json();r({title:"エラー",description:e.error||"投稿の削除に失敗しました。",variant:"error"})}}catch(e){r({title:"エラー",description:"ネットワークエラーが発生しました。",variant:"error"})}};return(0,i.jsxs)("div",{className:a().postCard,children:[(0,i.jsxs)("div",{className:a().postHeader,children:[(0,i.jsxs)(s.default,{href:`/users/${e.author.id}`,className:a().postAuthor,children:[e.author.name||"名無しユーザー",e.author.customId&&(0,i.jsxs)("span",{className:a().postAuthorCustomId,children:[" @",e.author.customId]})," "]}),i.jsx("span",{className:a().postDate,children:new Date(e.createdAt).toLocaleString()})]}),i.jsx("p",{className:a().postContent,children:(e=>{let t=[],n=0;return e.replace(/@([a-zA-Z0-9_]+)/g,(o,r,l)=>(l>n&&t.push(e.substring(n,l)),t.push(i.jsx(s.default,{href:`/users/@${r}`,className:a().mentionLink,children:o},l)),n=l+o.length,o)),n<e.length&&t.push(e.substring(n)),t})(e.content)}),(0,i.jsxs)("div",{className:a().postActions,children:[(0,i.jsxs)("button",{onClick:k,className:`${a().likeButton} ${d?a().liked:""}`,children:["いいね (",p,")"]}),i.jsx("button",{onClick:()=>C(!x),className:a().commentButton,children:"コメント"}),i.jsx("button",{ref:T,onClick:()=>{let t=`${window.location.origin}/posts/${e.id}`;navigator.clipboard.writeText(t).then(()=>{c({title:"成功",description:"投稿URLをコピーしました！",variant:"success",anchorElement:T.current})}).catch(()=>{c({title:"エラー",description:"URLのコピーに失敗しました。",variant:"error",anchorElement:T.current})})},className:a().shareButton,children:"共有"}),n&&e.author.id===n&&i.jsx("button",{onClick:P,className:a().deleteButton,children:"削除"})]}),x&&(0,i.jsxs)("div",{className:a().commentsSection,children:[(0,i.jsxs)("h4",{className:a().commentsTitle,children:["リプライ (",(e.children??[]).filter(e=>"REPLY"===e.type).length||0,")"]}),(g??[]).filter(e=>"REPLY"===e.type).length>0?i.jsx("div",{className:a().commentList,children:(g??[]).filter(e=>"REPLY"===e.type).map(e=>(0,i.jsxs)("div",{className:a().commentItem,children:[i.jsx(s.default,{href:`/users/${e.author.id}`,className:a().commentAuthor,children:e.author.name||`ユーザー ${e.author.id}`}),i.jsx("span",{className:a().commentDate,children:new Date(e.createdAt).toLocaleString("ja-JP",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),i.jsx("p",{className:a().commentContent,children:e.content}),n===e.author.id&&i.jsx("button",{onClick:t=>f(e.id,t),className:a().deleteCommentButton,children:"削除"})]},e.id))}):i.jsx("p",{className:a().noCommentsMessage,children:"まだリプライがありません。"}),i.jsx(u,{postId:e.id,onCommentSuccess:()=>{t&&t()}})]})]})}},7318:(e,t,n)=>{"use strict";n.d(t,{T:()=>c});var i=n(326),o=n(7577),s=n(8835),r=n.n(s),a=n(4695),l=n(9269),m=n(7531);let c=({posts:e,onPostDeleted:t})=>{let{showToast:n}=(0,l.p)(),{showPopover:s}=(0,m.t)(),[c,d]=(0,o.useState)(null),[u,_]=(0,o.useState)(null),[p,h]=(0,o.useState)(null);return((0,o.useEffect)(()=>{let e=localStorage.getItem("token");if(e)try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=JSON.parse(window.atob(t));d(n.userId)}catch(e){console.error("トークンのデコードに失敗しました",e),d(null)}},[e]),e&&0!==e.length)?i.jsx("div",{className:r().timelineContainer,children:e.map(e=>i.jsx(a.S,{post:e,onPostDeleted:t,currentUserId:c},e.id))}):i.jsx("div",{className:r().noPostsMessage,children:i.jsx("p",{children:"まだ投稿がありません。最初の投稿をしてみましょう！"})})}},5769:e=>{e.exports={commentForm:"CommentForm_commentForm__i01GW",textareaField:"CommentForm_textareaField__MwKjj",submitButton:"CommentForm_submitButton__FUJ5s",errorMessage:"CommentForm_errorMessage__5mag3"}},8835:e=>{e.exports={timelineContainer:"Timeline_timelineContainer__WppA0",postCard:"Timeline_postCard__uYZ6G",postHeader:"Timeline_postHeader__HB5Zr",authorLink:"Timeline_authorLink__dEne2",postDate:"Timeline_postDate__rxDpH",postContent:"Timeline_postContent__ykYZl",postActions:"Timeline_postActions__WRJIp",likeButton:"Timeline_likeButton__uGXsZ",deleteButton:"Timeline_deleteButton__aipxl",deleteCommentButton:"Timeline_deleteCommentButton__hPy4n",actionButton:"Timeline_actionButton__Vc6Up",liked:"Timeline_liked__BaUx6",likeIcon:"Timeline_likeIcon__w6slr",noPostsMessage:"Timeline_noPostsMessage__hSXgH",commentsSection:"Timeline_commentsSection__iLyP0",commentsTitle:"Timeline_commentsTitle__pydHp",commentList:"Timeline_commentList__2M_o7",commentItem:"Timeline_commentItem__t3_hZ",commentAuthor:"Timeline_commentAuthor__RmxM7",commentDate:"Timeline_commentDate___0FII",commentContent:"Timeline_commentContent__VXGfn",noCommentsMessage:"Timeline_noCommentsMessage__cuM0l",quotedPost:"Timeline_quotedPost__ysRJM",repostedPost:"Timeline_repostedPost__Jh1if",replyToPost:"Timeline_replyToPost__4xRUq",quotedPostHeader:"Timeline_quotedPostHeader__m4Hb_",repostedPostHeader:"Timeline_repostedPostHeader__XOZdY",quotedPostContent:"Timeline_quotedPostContent__uUycL",repostedPostContent:"Timeline_repostedPostContent__mWZgd",quoteFormContainer:"Timeline_quoteFormContainer__tHgf1",mentionLink:"Timeline_mentionLink__GHGHW",postAuthorCustomId:"Timeline_postAuthorCustomId__rI2Sx"}}};