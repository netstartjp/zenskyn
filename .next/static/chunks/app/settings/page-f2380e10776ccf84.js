(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{2546:function(e,t,r){Promise.resolve().then(r.bind(r,3097))},3097:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(7437),s=r(2265),i=r(8211),n=r(763),o=r.n(n);let l=()=>{let{showToast:e}=(0,i.p)(),[t,r]=(0,s.useState)(null),[n,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[d,m]=(0,s.useState)(""),[p,f]=(0,s.useState)(""),[h,g]=(0,s.useState)(""),[v,x]=(0,s.useState)(""),[j,_]=(0,s.useState)(!0),[N,b]=(0,s.useState)(null),w=(0,s.useCallback)(async()=>{_(!0),b(null);let e=localStorage.getItem("token");if(!e){b("認証が必要です。"),_(!1);return}try{let t=await fetch("/api/auth/status",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let a=(await t.json()).userId,s=await fetch("/api/users/".concat(a),{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){let e=await s.json();r(e),l(e.name||""),u(e.bio||""),m(e.profileImageUrl||""),f(e.customId||"")}else{let e=await s.json();b(e.error||"ユーザープロフィールの取得に失敗しました。")}}else{let e=await t.json();b(e.error||"認証情報の取得に失敗しました。")}}catch(e){b("予期せぬエラーが発生しました。"),console.error(e)}finally{_(!1)}},[]);(0,s.useEffect)(()=>{w()},[w]);let S=async r=>{if(r.preventDefault(),b(null),!t){e({title:"エラー",description:"ユーザー情報が読み込まれていません。",variant:"error"});return}if(h!==v){e({title:"エラー",description:"パスワードが一致しません。",variant:"error"});return}let a=localStorage.getItem("token");if(!a){e({title:"エラー",description:"認証が必要です。",variant:"error"});return}let s={};if(n!==t.name){if(null!==n){let r=await fetch("/api/users/check-name?name=".concat(encodeURIComponent(n)));if(!r.ok){e({title:"エラー",description:(await r.json()).error||"ユーザー名の重複チェックに失敗しました。",variant:"error"});return}let a=await r.json();if(a.exists&&a.userId!==t.id){e({title:"エラー",description:"このユーザー名はすでに使用されています。別の名前をお試しください。",variant:"error"});return}}s.name=n}c!==t.bio&&(s.bio=c),d!==t.profileImageUrl&&(s.profileImageUrl=d),""!==h&&(s.password=h);let i=!1;if(p!==(t.customId||""))try{let r=await fetch("/api/users/".concat(t.id,"/custom-id"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({customId:p})});if(!r.ok){let t=await r.json();e({title:"エラー",description:t.error||"カスタムIDの更新に失敗しました。",variant:"error"});return}i=!0}catch(t){e({title:"エラー",description:"カスタムIDの更新中にエラーが発生しました。",variant:"error"}),console.error(t);return}if(0===Object.keys(s).length&&!i){e({title:"情報",description:"変更がありません。",variant:"info"});return}try{let r=await fetch("/api/users/".concat(t.id,"/update"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(s)});if(r.ok)e({title:"成功",description:"プロフィールが正常に更新されました。",variant:"success"}),w();else{let t=await r.json();e({title:"エラー",description:t.error||"プロフィールの更新に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"予期せぬエラーが発生しました。",variant:"error"}),console.error(t)}};return j?(0,a.jsx)("div",{className:o().loadingMessage,children:"設定を読み込み中..."}):N?(0,a.jsx)("div",{className:o().errorMessage,children:N}):(0,a.jsxs)("div",{className:o().settingsContainer,children:[(0,a.jsx)("h2",{className:o().sectionTitle,children:"プロフィール設定"}),(0,a.jsxs)("form",{onSubmit:S,className:o().form,children:[(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"name",className:o().formLabel,children:"名前:"}),(0,a.jsx)("input",{type:"text",id:"name",value:n,onChange:e=>l(e.target.value),className:o().inputField})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"bio",className:o().formLabel,children:"自己紹介:"}),(0,a.jsx)("textarea",{id:"bio",value:c,onChange:e=>u(e.target.value),className:o().textareaField,rows:3})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"profileImageUrl",className:o().formLabel,children:"プロフィール画像URL:"}),(0,a.jsx)("input",{type:"text",id:"profileImageUrl",value:d,onChange:e=>m(e.target.value),className:o().inputField})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"customId",className:o().formLabel,children:"カスタムID (@なし):"}),(0,a.jsx)("input",{type:"text",id:"customId",value:p,onChange:e=>f(e.target.value),className:o().inputField,placeholder:"例: myusername"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"password",className:o().formLabel,children:"新しいパスワード (変更する場合のみ):"}),(0,a.jsx)("input",{type:"password",id:"password",value:h,onChange:e=>g(e.target.value),className:o().inputField,placeholder:"新しいパスワード"})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:o().formLabel,children:"新しいパスワード (確認):"}),(0,a.jsx)("input",{type:"password",id:"confirmPassword",value:v,onChange:e=>x(e.target.value),className:o().inputField,placeholder:"新しいパスワードを再入力"})]}),(0,a.jsx)("div",{className:o().formActions,children:(0,a.jsx)("button",{type:"submit",className:o().saveButton,children:"設定を保存"})})]})]})};var c=r(6297),u=r.n(c);function d(){return(0,a.jsxs)("div",{className:u().container,children:[(0,a.jsx)("h1",{className:u().title,children:"ユーザー設定"}),(0,a.jsx)(l,{})]})}},8211:function(e,t,r){"use strict";r.d(t,{V:function(){return o},p:function(){return l}});var a=r(7437),s=r(2265),i=r(5803);let n=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)({title:"",description:"",variant:"info"}),u=s.useRef(null),d=(0,s.useCallback)(e=>{c(e),o(!0),u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(()=>{o(!1)},3e3)},[]);return(0,a.jsxs)(i.zt,{swipeDirection:"right",children:[(0,a.jsx)(n.Provider,{value:{showToast:d},children:t}),(0,a.jsxs)(i.fC,{open:r,onOpenChange:o,className:"toast ".concat(l.variant),children:[(0,a.jsx)(i.Dx,{children:l.title}),l.description&&(0,a.jsx)(i.dk,{children:l.description})]}),(0,a.jsx)(i.l_,{})]})}function l(){let e=(0,s.useContext)(n);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},6297:function(e){e.exports={container:"settings_container__2ie5P",title:"settings_title__DMbFh"}},763:function(e){e.exports={settingsContainer:"UserSettings_settingsContainer__bF265",sectionTitle:"UserSettings_sectionTitle__5higR",form:"UserSettings_form__V8S5j",formGroup:"UserSettings_formGroup__ruwuw",formLabel:"UserSettings_formLabel__KcGCG",inputField:"UserSettings_inputField__uj2DX",textareaField:"UserSettings_textareaField__ABtg7",formActions:"UserSettings_formActions__h_lYg",saveButton:"UserSettings_saveButton__07UDo",loadingMessage:"UserSettings_loadingMessage__x7FNh",errorMessage:"UserSettings_errorMessage__5G5Pc"}}},function(e){e.O(0,[182,803,971,117,744],function(){return e(e.s=2546)}),_N_E=e.O()}]);