(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{9356:function(e,t,n){Promise.resolve().then(n.bind(n,6683))},9376:function(e,t,n){"use strict";var i=n(5475);n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})},6683:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var i=n(7437),r=n(2265),a=n(9376),s=n(7648),o=n(7384),c=n.n(o),l=n(8211),d=n(1310);function u(){let{showToast:e}=(0,l.p)(),{showPopover:t}=(0,d.t)(),[n,o]=(0,r.useState)([]),[u,h]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[f,j]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),b=(0,a.useRouter)(),C=(0,r.useCallback)(async()=>{x(!0),j(null);let e=localStorage.getItem("token");if(!e){j("認証が必要です。"),x(!1),b.push("/");return}try{let t=await fetch("/api/auth/status",{headers:{Authorization:"Bearer ".concat(e)}}),n=await t.json();if(!t.ok||!n.isAdmin){j("管理者権限がありません。"),x(!1),b.push("/");return}g(n.userId);let i=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(e)}});if(i.ok){let e=await i.json();o(e)}else{let e=await i.json();j(e.error||"ユーザーデータの取得に失敗しました。")}let r=await fetch("/api/posts",{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){let e=await r.json();h(e)}else{let e=await r.json();j(e.error||"投稿データの取得に失敗しました。")}}catch(e){j("データの取得中に予期せぬエラーが発生しました。"),console.error(e)}finally{x(!1)}},[b]);(0,r.useEffect)(()=>{C()},[C]);let v=async(n,i)=>{let r=localStorage.getItem("token");if(!r){e({title:"エラー",description:"ユーザーを削除するにはログインが必要です。",variant:"error"});return}t({anchorElement:i.currentTarget,title:"確認",description:"このユーザーを削除してもよろしいですか？この操作は元に戻せません。",variant:"warning",onConfirm:async()=>{try{let t=await fetch("/api/users/".concat(n),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});if(t.ok)e({title:"成功",description:"ユーザーが削除されました。",variant:"success"}),C();else{let n=await t.json();e({title:"エラー",description:n.error||"ユーザーの削除に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"ユーザー削除中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"ユーザーの削除をキャンセルしました。",variant:"info"})}})},_=async(n,i,r)=>{t({anchorElement:r.currentTarget,title:"確認",description:"このユーザーの管理者権限を".concat(i?"解除":"付与","してもよろしいですか？"),variant:"info",onConfirm:async()=>{let t=localStorage.getItem("token");if(n===p&&i){e({title:"警告",description:"自分自身の管理者権限を解除することはできません。システムに管理者がいなくなります。",variant:"warning"});return}try{let r=await fetch("/api/admin/users/".concat(n),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({isAdmin:!i})});if(r.ok)e({title:"成功",description:"ユーザーの管理者権限を".concat(i?"解除":"付与","しました。"),variant:"success"}),C();else{let t=await r.json();e({title:"エラー",description:t.error||"管理者権限の変更に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"管理者権限の変更中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"管理者権限の変更をキャンセルしました。",variant:"info"})}})},w=async(n,i)=>{let r=localStorage.getItem("token");if(!r){e({title:"エラー",description:"投稿を削除するにはログインが必要です。",variant:"error"});return}t({anchorElement:i.currentTarget,title:"確認",description:"この投稿を削除してもよろしいですか？この操作は元に戻せません。",variant:"warning",onConfirm:async()=>{try{let t=await fetch("/api/posts/".concat(n),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}});if(t.ok)e({title:"成功",description:"投稿が削除されました。",variant:"success"}),C();else{let n=await t.json();e({title:"エラー",description:n.error||"投稿の削除に失敗しました。",variant:"error"})}}catch(t){e({title:"エラー",description:"投稿削除中にエラーが発生しました。",variant:"error"})}},onCancel:()=>{e({title:"キャンセル",description:"投稿の削除をキャンセルしました。",variant:"info"})}})};return m?(0,i.jsx)("div",{className:c().loadingMessage,children:"管理者ダッシュボードを読み込み中..."}):f?(0,i.jsx)("div",{className:c().errorMessage,children:f}):(0,i.jsxs)("div",{className:c().container,children:[(0,i.jsxs)("header",{className:c().header,children:[(0,i.jsx)("h1",{className:c().title,children:"管理者ダッシュボード"}),(0,i.jsx)(s.default,{href:"/",children:(0,i.jsx)("button",{className:c().backButton,children:"ホームに戻る"})})]}),(0,i.jsxs)("main",{className:c().mainContent,children:[(0,i.jsxs)("section",{className:c().section,children:[(0,i.jsx)("h2",{className:c().sectionTitle,children:"ユーザー管理"}),(0,i.jsx)("div",{className:c().tableContainer,children:(0,i.jsxs)("table",{className:c().table,children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"名前"}),(0,i.jsx)("th",{children:"メール"}),(0,i.jsx)("th",{children:"管理者"}),(0,i.jsx)("th",{children:"操作"})]})}),(0,i.jsx)("tbody",{children:n.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsx)("td",{children:e.name||"N/A"}),(0,i.jsx)("td",{children:e.email}),(0,i.jsx)("td",{children:e.isAdmin?"はい":"いいえ"}),(0,i.jsxs)("td",{children:[(0,i.jsx)("button",{onClick:()=>b.push("/users/".concat(e.id)),className:c().actionButton,children:"表示"}),(0,i.jsx)("button",{onClick:t=>v(e.id,t),className:"".concat(c().actionButton," ").concat(c().deleteButton),disabled:e.id===p,children:"削除"}),(0,i.jsx)("button",{onClick:t=>_(e.id,e.isAdmin,t),className:"".concat(c().actionButton," ").concat(e.isAdmin?c().revokeAdmin:c().grantAdmin),disabled:e.id===p,children:e.isAdmin?"管理者解除":"管理者付与"})]})]},e.id))})]})})]}),(0,i.jsxs)("section",{className:c().section,children:[(0,i.jsx)("h2",{className:c().sectionTitle,children:"投稿管理"}),(0,i.jsx)("div",{className:c().tableContainer,children:(0,i.jsxs)("table",{className:c().table,children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"内容"}),(0,i.jsx)("th",{children:"投稿者"}),(0,i.jsx)("th",{children:"いいね数"}),(0,i.jsx)("th",{children:"操作"})]})}),(0,i.jsx)("tbody",{children:u.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.id}),(0,i.jsxs)("td",{children:[e.content.substring(0,50),"..."]}),(0,i.jsx)("td",{children:e.author.name||"ユーザー ".concat(e.author.id)}),(0,i.jsx)("td",{children:e.likesCount}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{onClick:t=>w(e.id,t),className:"".concat(c().actionButton," ").concat(c().deleteButton),children:"削除"})})]},e.id))})]})})]})]})]})}},1310:function(e,t,n){"use strict";n.d(t,{t:function(){return c},u:function(){return o}});var i=n(7437),r=n(2265),a=n(5367);let s=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,r.useState)(!1),[c,l]=(0,r.useState)(null),d=(0,r.useRef)(null),u=(0,r.useCallback)(()=>{o(!1),l(null),d.current&&(window.clearTimeout(d.current),d.current=null)},[]),h=(0,r.useCallback)(e=>{let{anchorElement:t,duration:n=3e3,...i}=e;u(),l({...i,anchorElement:t,duration:n}),o(!0),n>0&&(d.current=window.setTimeout(()=>{u()},n))},[u]),m=(0,r.useCallback)(()=>{(null==c?void 0:c.onConfirm)&&c.onConfirm(),u()},[c,u]),x=(0,r.useCallback)(()=>{(null==c?void 0:c.onCancel)&&c.onCancel(),u()},[c,u]),f=c?(e=>{switch(e){case"success":return{bg:"bg-green-500",text:"text-white"};case"error":return{bg:"bg-red-500",text:"text-white"};case"warning":return{bg:"bg-yellow-500",text:"text-gray-900"};default:return{bg:"bg-blue-500",text:"text-white"}}})(c.variant||"info"):{bg:"",text:""};return(0,i.jsxs)(s.Provider,{value:{showPopover:h},children:[t,c&&c.anchorElement&&(0,i.jsxs)(a.fC,{open:n,onOpenChange:o,children:[(0,i.jsx)(a.ee,{asChild:!0,children:(0,i.jsx)("div",{style:{position:"absolute",top:c.anchorElement.getBoundingClientRect().top,left:c.anchorElement.getBoundingClientRect().left,width:c.anchorElement.getBoundingClientRect().width,height:c.anchorElement.getBoundingClientRect().height,pointerEvents:"none"}})}),(0,i.jsx)(a.h_,{children:(0,i.jsxs)(a.VY,{className:"rounded-md shadow-lg p-4 text-sm ".concat(f.bg," ").concat(f.text),sideOffset:5,onOpenAutoFocus:e=>e.preventDefault(),onCloseAutoFocus:e=>e.preventDefault(),children:[(0,i.jsx)("h3",{className:"font-medium",children:c.title}),c.description&&(0,i.jsx)("p",{children:c.description}),(c.onConfirm||c.onCancel)&&(0,i.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[c.onCancel&&(0,i.jsx)("button",{onClick:x,className:"px-3 py-1 rounded bg-gray-300 text-gray-800 hover:bg-gray-400",children:"キャンセル"}),c.onConfirm&&(0,i.jsx)("button",{onClick:m,className:"px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700",children:"OK"})]}),(0,i.jsx)(a.Eh,{className:"fill-current text-white"}),(0,i.jsx)("button",{className:"absolute top-1 right-1 p-1 rounded-full hover:bg-opacity-20 focus:outline-none focus:ring-2 focus:ring-opacity-50",onClick:u,children:"✕"})]})})]})]})}function c(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useClickableToastPopover must be used within a ClickableToastPopoverProvider");return e}},8211:function(e,t,n){"use strict";n.d(t,{V:function(){return o},p:function(){return c}});var i=n(7437),r=n(2265),a=n(5803);let s=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[n,o]=(0,r.useState)(!1),[c,l]=(0,r.useState)({title:"",description:"",variant:"info"}),d=r.useRef(null),u=(0,r.useCallback)(e=>{l(e),o(!0),d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{o(!1)},3e3)},[]);return(0,i.jsxs)(a.zt,{swipeDirection:"right",children:[(0,i.jsx)(s.Provider,{value:{showToast:u},children:t}),(0,i.jsxs)(a.fC,{open:n,onOpenChange:o,className:"toast ".concat(c.variant),children:[(0,i.jsx)(a.Dx,{children:c.title}),c.description&&(0,i.jsx)(a.dk,{children:c.description})]}),(0,i.jsx)(a.l_,{})]})}function c(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}},7384:function(e){e.exports={container:"admin_container__uVSVc",header:"admin_header__BXCuK",title:"admin_title__cLzhO",backButton:"admin_backButton__6_Chd",loadingMessage:"admin_loadingMessage__9YF44",errorMessage:"admin_errorMessage__aG44D",mainContent:"admin_mainContent__LKiLk",section:"admin_section__ID0dh",sectionTitle:"admin_sectionTitle__1MY2W",tableContainer:"admin_tableContainer__GVxxO",table:"admin_table__Wi_BD",actionButton:"admin_actionButton__sA_2Z",deleteButton:"admin_deleteButton__CwIux"}}},function(e){e.O(0,[24,803,555,971,117,744],function(){return e(e.s=9356)}),_N_E=e.O()}]);